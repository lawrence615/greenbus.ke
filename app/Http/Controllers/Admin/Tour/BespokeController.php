<?php

namespace App\Http\Controllers\Admin\Tour;

use Illuminate\Http\Request;
use Illuminate\Support\Facades\DB;

use App\Http\Controllers\Controller;
use App\Http\Requests\Tour\Bespoke\StoreRequest;
use App\Interfaces\LocationRepositoryInterface;
use App\Interfaces\Tour\BespokeRepositoryInterface;
use App\Models\Tour;

class BespokeController extends Controller
{
    public function __construct(
        private readonly LocationRepositoryInterface $locationRepository,
        private readonly BespokeRepositoryInterface $bespokeRepository
    ) {}

    public function index()
    {
        throw new \Exception('Not implemented');
    }

    public function create()
    {
        $locations = $this->locationRepository->getAll();

        return view('admin.tours.bespoke.create', compact('locations'));
    }

    public function store(StoreRequest $request)
    {
        $validated = $request->validated();

        $tour = null;
        DB::transaction(function () use ($validated, $request, &$tour) {
            $tourData = [
                'title' => $validated['title'],
                'slug' => null, // Will be generated by the repository
                'description' => $validated['description'],
                'tour_category_id' => 4, // Multiple Day Tours category for bespoke
                'location_id' => $validated['location_id'],
                'status' => 'draft',
                'tour_type' => 'bespoke',
                'code' => $validated['code'],
            ];

            $tour = $this->bespokeRepository->store($tourData);
        });
    }

    public function edit(Tour $tour)
    {
        throw new \Exception('Not implemented');
    }

    public function update(Request $request, Tour $tour)
    {
        throw new \Exception('Not implemented');
    }

    public function destroy(Tour $tour)
    {
        throw new \Exception('Not implemented');
    }
}
